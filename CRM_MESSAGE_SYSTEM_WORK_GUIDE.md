# CRM ë©”ì‹œì§€ ì‹œìŠ¤í…œ ì‘ì—…ì§€ì‹œì„œ

> ì‘ì„±ì¼: 2025-11-04  
> ëª©ì : ê´€ë¦¬ìê°€ ê³ ê°ì—ê²Œ íŒì—… ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆëŠ” ì‹œìŠ¤í…œ êµ¬ì¶•  
> ëŒ€ìƒ: ì½”ë”© ì§€ì‹ ì—†ì´ë„ ë”°ë¼í•  ìˆ˜ ìˆëŠ” ìƒì„¸ ê°€ì´ë“œ

---

## ğŸ“‹ ëª©ì°¨

1. [ì‘ì—… ê°œìš”](#1-ì‘ì—…-ê°œìš”)
2. [ì‘ì—… ìˆœì„œ](#2-ì‘ì—…-ìˆœì„œ)
3. [ë‹¨ê³„ë³„ ìƒì„¸ ì‘ì—…ì§€ì‹œ](#3-ë‹¨ê³„ë³„-ìƒì„¸-ì‘ì—…ì§€ì‹œ)
4. [í…ŒìŠ¤íŠ¸ ë°©ë²•](#4-í…ŒìŠ¤íŠ¸-ë°©ë²•)
5. [ë¬¸ì œ í•´ê²°](#5-ë¬¸ì œ-í•´ê²°)

---

## 1. ì‘ì—… ê°œìš”

### 1.1 ë§Œë“¤ ê¸°ëŠ¥

**ê´€ë¦¬ì ê¸°ëŠ¥**:
- ì „ì²´ ê³ ê°ì—ê²Œ ë©”ì‹œì§€ ë³´ë‚´ê¸°
- íŠ¹ì • ê³ ê°ì—ê²Œ ë©”ì‹œì§€ ë³´ë‚´ê¸°
- ë©”ì‹œì§€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ
- ë©”ì‹œì§€ ë°œì†¡ ì´ë ¥ ì¡°íšŒ

**ê³ ê° ê¸°ëŠ¥**:
- ë¡œê·¸ì¸ ì‹œ ë¯¸í™•ì¸ ë©”ì‹œì§€ í™•ì¸
- íŒì—… ë©”ì‹œì§€ë¡œ í‘œì‹œ
- ë©”ì‹œì§€ í™•ì¸ ì²˜ë¦¬

---

## 2. ì‘ì—… ìˆœì„œ

### ì „ì²´ ì‘ì—… íë¦„

```
1ë‹¨ê³„: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì¶”ê°€ (5ë¶„)
   â†“
2ë‹¨ê³„: API ì—”ë“œí¬ì¸íŠ¸ ìƒì„± (10ë¶„)
   â†“
3ë‹¨ê³„: ê´€ë¦¬ì í˜ì´ì§€ UI ìƒì„± (15ë¶„)
   â†“
4ë‹¨ê³„: ê³ ê° í˜ì´ì§€ íŒì—… ì»´í¬ë„ŒíŠ¸ ìƒì„± (10ë¶„)
   â†“
5ë‹¨ê³„: í†µí•© í…ŒìŠ¤íŠ¸ (5ë¶„)
```

**ì´ ì˜ˆìƒ ì‹œê°„**: ì•½ 45ë¶„

---

## 3. ë‹¨ê³„ë³„ ìƒì„¸ ì‘ì—…ì§€ì‹œ

### ğŸ”´ 1ë‹¨ê³„: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì¶”ê°€

**ëª©ì **: ë©”ì‹œì§€ë¥¼ ì €ì¥í•  ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ë§Œë“¤ê¸°

**ì‘ì—… ë‚´ìš©**: `prisma/schema.prisma` íŒŒì¼ì— ìƒˆë¡œìš´ ëª¨ë¸ ì¶”ê°€

**íŒŒì¼ ìœ„ì¹˜**: `/home/userhyeseon28/projects/cruise-guide/prisma/schema.prisma`

**ì‘ì—… ë°©ë²•**:

1. **íŒŒì¼ ì—´ê¸°**
   - íŒŒì¼ íƒìƒ‰ê¸°ì—ì„œ `cruise-guide` í´ë” ì—´ê¸°
   - `prisma` í´ë” ì—´ê¸°
   - `schema.prisma` íŒŒì¼ ì—´ê¸°

2. **íŒŒì¼ ëë¶€ë¶„ ì°¾ê¸°**
   - íŒŒì¼ ë§¨ ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤
   - `CmsNotificationTemplate` ëª¨ë¸ ë’¤ì— ì¶”ê°€

3. **ì•„ë˜ ì½”ë“œ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°**

```prisma
// ê´€ë¦¬ì â†’ ê³ ê° ë©”ì‹œì§€ ì‹œìŠ¤í…œ
model AdminMessage {
  id          Int      @id @default(autoincrement())
  
  // ë°œì‹ ì (ê´€ë¦¬ì)
  adminId     Int      // ê´€ë¦¬ì User ID
  admin       User     @relation("AdminMessages", fields: [adminId], references: [id])
  
  // ìˆ˜ì‹ ì (ê³ ê°)
  userId      Int?     // nullì´ë©´ ì „ì²´ ê³ ê° ëŒ€ìƒ
  user        User?    @relation("ReceivedMessages", fields: [userId], references: [id])
  
  // ë©”ì‹œì§€ ë‚´ìš©
  title       String   // ë©”ì‹œì§€ ì œëª©
  content     String   // ë©”ì‹œì§€ ë‚´ìš© (HTML í—ˆìš©)
  messageType String   @default("info") // 'info', 'warning', 'promotion', 'announcement'
  
  // ë°œì†¡ ì„¤ì •
  isActive    Boolean  @default(true) // í™œì„±í™” ì—¬ë¶€
  sendAt      DateTime? // ì˜ˆì•½ ë°œì†¡ ì‹œê°„ (nullì´ë©´ ì¦‰ì‹œ)
  
  // í™•ì¸ ìƒíƒœ
  readCount   Int      @default(0) // í™•ì¸í•œ ê³ ê° ìˆ˜
  totalSent   Int      @default(0) // ë°œì†¡ëœ ê³ ê° ìˆ˜
  
  // ë©”íƒ€ë°ì´í„°
  metadata    Json?    // ì¶”ê°€ ì •ë³´ (JSON)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId, isActive, createdAt])
  @@index([adminId, createdAt])
}

// ê³ ê°ë³„ ë©”ì‹œì§€ í™•ì¸ ìƒíƒœ
model UserMessageRead {
  id          Int      @id @default(autoincrement())
  userId      Int
  user        User     @relation("MessageReads", fields: [userId], references: [id])
  messageId   Int
  message     AdminMessage @relation("MessageReads", fields: [messageId], references: [id])
  
  readAt      DateTime @default(now())
  
  @@unique([userId, messageId])
  @@index([userId, readAt])
}
```

4. **User ëª¨ë¸ì— ê´€ê³„ ì¶”ê°€**
   - `schema.prisma` íŒŒì¼ì—ì„œ `model User {` ë¶€ë¶„ ì°¾ê¸°
   - `pushSubscriptions PushSubscription[]` ì¤„ ë’¤ì— ì•„ë˜ ì½”ë“œ ì¶”ê°€:

```prisma
  // ê´€ë¦¬ì ë©”ì‹œì§€ ê´€ê³„
  adminMessages      AdminMessage[] @relation("AdminMessages")
  receivedMessages   AdminMessage[] @relation("ReceivedMessages")
  messageReads       UserMessageRead[] @relation("MessageReads")
```

5. **ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸**
   - í„°ë¯¸ë„ ì—´ê¸° (Ctrl + ` ë˜ëŠ” í„°ë¯¸ë„ ë©”ë‰´)
   - ì•„ë˜ ëª…ë ¹ì–´ ì‹¤í–‰:

```bash
cd /home/userhyeseon28/projects/cruise-guide
npx prisma migrate dev --name add_admin_message_system
```

**âœ… ì™„ë£Œ í™•ì¸**: 
- í„°ë¯¸ë„ì— "Migration applied successfully" ë©”ì‹œì§€ê°€ ë‚˜ì˜¤ë©´ ì„±ê³µ
- ì—ëŸ¬ê°€ ë‚˜ì˜¤ë©´ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë³µì‚¬í•´ì„œ ì €ì¥

---

### ğŸ”´ 2ë‹¨ê³„: API ì—”ë“œí¬ì¸íŠ¸ ìƒì„±

**ëª©ì **: ê´€ë¦¬ìê°€ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ê³ , ê³ ê°ì´ ë©”ì‹œì§€ë¥¼ ë°›ì„ ìˆ˜ ìˆëŠ” API ë§Œë“¤ê¸°

**ì‘ì—… ìˆœì„œ**:

#### 2-1. ê´€ë¦¬ì ë©”ì‹œì§€ ê´€ë¦¬ API ìƒì„±

**íŒŒì¼ ìƒì„±**: `/home/userhyeseon28/projects/cruise-guide/app/api/admin/messages/route.ts`

**ì‘ì—… ë°©ë²•**:
1. íŒŒì¼ íƒìƒ‰ê¸°ì—ì„œ `app/api/admin` í´ë” ì—´ê¸°
2. `messages` í´ë” ìƒì„±
3. `route.ts` íŒŒì¼ ìƒì„±
4. ì•„ë˜ ì½”ë“œ ì „ì²´ë¥¼ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°:

```typescript
import { NextRequest, NextResponse } from 'next/server';
import prisma from '@/lib/prisma';
import { getSessionUser } from '@/lib/auth';

// ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
async function checkAdminAuth() {
  const user = await getSessionUser();
  if (!user || user.role !== 'admin') {
    return null;
  }
  return user;
}

// GET: ë©”ì‹œì§€ ëª©ë¡ ì¡°íšŒ
export async function GET(req: NextRequest) {
  try {
    const admin = await checkAdminAuth();
    if (!admin) {
      return NextResponse.json({ ok: false, error: 'Unauthorized' }, { status: 401 });
    }

    const { searchParams } = new URL(req.url);
    const userId = searchParams.get('userId'); // íŠ¹ì • ê³ ê°ì˜ ë©”ì‹œì§€ë§Œ ì¡°íšŒ

    const where: any = {};
    if (userId) {
      where.userId = parseInt(userId);
    }

    const messages = await prisma.adminMessage.findMany({
      where,
      include: {
        admin: {
          select: { id: true, name: true },
        },
        user: {
          select: { id: true, name: true, phone: true },
        },
        _count: {
          select: { messageReads: true },
        },
      },
      orderBy: { createdAt: 'desc' },
      take: 100,
    });

    return NextResponse.json({ ok: true, messages });
  } catch (error) {
    console.error('[Admin Messages GET] Error:', error);
    return NextResponse.json(
      { ok: false, error: 'Failed to fetch messages' },
      { status: 500 }
    );
  }
}

// POST: ìƒˆ ë©”ì‹œì§€ ìƒì„±
export async function POST(req: NextRequest) {
  try {
    const admin = await checkAdminAuth();
    if (!admin) {
      return NextResponse.json({ ok: false, error: 'Unauthorized' }, { status: 401 });
    }

    const { userId, title, content, messageType, sendAt } = await req.json();

    if (!title || !content) {
      return NextResponse.json(
        { ok: false, error: 'Title and content are required' },
        { status: 400 }
      );
    }

    // ë©”ì‹œì§€ ìƒì„±
    const message = await prisma.adminMessage.create({
      data: {
        adminId: admin.id,
        userId: userId ? parseInt(userId) : null, // nullì´ë©´ ì „ì²´ ê³ ê°
        title,
        content,
        messageType: messageType || 'info',
        sendAt: sendAt ? new Date(sendAt) : null,
        totalSent: userId ? 1 : 0, // íŠ¹ì • ê³ ê°ì´ë©´ 1, ì „ì²´ë©´ 0 (ë‚˜ì¤‘ì— ê³„ì‚°)
      },
    });

    // ì „ì²´ ê³ ê° ëŒ€ìƒì´ë©´ ì´ ê³ ê° ìˆ˜ ê³„ì‚°
    if (!userId) {
      const totalUsers = await prisma.user.count({
        where: { role: 'user' },
      });
      await prisma.adminMessage.update({
        where: { id: message.id },
        data: { totalSent: totalUsers },
      });
    }

    return NextResponse.json({ ok: true, message });
  } catch (error) {
    console.error('[Admin Messages POST] Error:', error);
    return NextResponse.json(
      { ok: false, error: 'Failed to create message' },
      { status: 500 }
    );
  }
}

// PUT: ë©”ì‹œì§€ ìˆ˜ì •
export async function PUT(req: NextRequest) {
  try {
    const admin = await checkAdminAuth();
    if (!admin) {
      return NextResponse.json({ ok: false, error: 'Unauthorized' }, { status: 401 });
    }

    const { id, title, content, messageType, isActive } = await req.json();

    if (!id) {
      return NextResponse.json(
        { ok: false, error: 'Message ID is required' },
        { status: 400 }
      );
    }

    const message = await prisma.adminMessage.update({
      where: { id: parseInt(id) },
      data: {
        title,
        content,
        messageType,
        isActive,
      },
    });

    return NextResponse.json({ ok: true, message });
  } catch (error) {
    console.error('[Admin Messages PUT] Error:', error);
    return NextResponse.json(
      { ok: false, error: 'Failed to update message' },
      { status: 500 }
    );
  }
}

// DELETE: ë©”ì‹œì§€ ì‚­ì œ
export async function DELETE(req: NextRequest) {
  try {
    const admin = await checkAdminAuth();
    if (!admin) {
      return NextResponse.json({ ok: false, error: 'Unauthorized' }, { status: 401 });
    }

    const { searchParams } = new URL(req.url);
    const id = searchParams.get('id');

    if (!id) {
      return NextResponse.json(
        { ok: false, error: 'Message ID is required' },
        { status: 400 }
      );
    }

    await prisma.adminMessage.delete({
      where: { id: parseInt(id) },
    });

    return NextResponse.json({ ok: true });
  } catch (error) {
    console.error('[Admin Messages DELETE] Error:', error);
    return NextResponse.json(
      { ok: false, error: 'Failed to delete message' },
      { status: 500 }
    );
  }
}
```

**âœ… ì™„ë£Œ í™•ì¸**: íŒŒì¼ì´ ì €ì¥ë˜ì—ˆëŠ”ì§€ í™•ì¸

---

#### 2-2. ê³ ê° ë©”ì‹œì§€ ì¡°íšŒ API ìƒì„±

**íŒŒì¼ ìƒì„±**: `/home/userhyeseon28/projects/cruise-guide/app/api/user/messages/route.ts`

**ì‘ì—… ë°©ë²•**:
1. íŒŒì¼ íƒìƒ‰ê¸°ì—ì„œ `app/api/user` í´ë” ì—´ê¸°
2. `messages` í´ë” ìƒì„±
3. `route.ts` íŒŒì¼ ìƒì„±
4. ì•„ë˜ ì½”ë“œ ì „ì²´ë¥¼ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°:

```typescript
import { NextRequest, NextResponse } from 'next/server';
import prisma from '@/lib/prisma';
import { getSessionUser } from '@/lib/auth';

// GET: ê³ ê°ì˜ ë¯¸í™•ì¸ ë©”ì‹œì§€ ì¡°íšŒ
export async function GET(req: NextRequest) {
  try {
    const user = await getSessionUser();
    if (!user) {
      return NextResponse.json({ ok: false, error: 'Unauthorized' }, { status: 401 });
    }

    // í˜„ì¬ ì‚¬ìš©ìì—ê²Œ ë°œì†¡ëœ ë©”ì‹œì§€ ì¡°íšŒ
    // 1) ìì‹ ì—ê²Œ ì§ì ‘ ë°œì†¡ëœ ë©”ì‹œì§€
    // 2) ì „ì²´ ê³ ê° ëŒ€ìƒ ë©”ì‹œì§€
    const messages = await prisma.adminMessage.findMany({
      where: {
        isActive: true,
        OR: [
          { userId: user.id }, // ìì‹ ì—ê²Œ ì§ì ‘ ë°œì†¡
          { userId: null }, // ì „ì²´ ê³ ê° ëŒ€ìƒ
        ],
        // ë°œì†¡ ì‹œê°„ ì²´í¬ (ì˜ˆì•½ ë°œì†¡)
        OR: [
          { sendAt: null }, // ì¦‰ì‹œ ë°œì†¡
          { sendAt: { lte: new Date() } }, // ì˜ˆì•½ ì‹œê°„ì´ ì§€ë‚œ ê²ƒ
        ],
        // ì•„ì§ í™•ì¸í•˜ì§€ ì•Šì€ ë©”ì‹œì§€
        NOT: {
          messageReads: {
            some: {
              userId: user.id,
            },
          },
        },
      },
      include: {
        admin: {
          select: { id: true, name: true },
        },
      },
      orderBy: { createdAt: 'desc' },
      take: 10, // ìµœëŒ€ 10ê°œ
    });

    return NextResponse.json({ ok: true, messages });
  } catch (error) {
    console.error('[User Messages GET] Error:', error);
    return NextResponse.json(
      { ok: false, error: 'Failed to fetch messages' },
      { status: 500 }
    );
  }
}
```

---

#### 2-3. ë©”ì‹œì§€ í™•ì¸ ì²˜ë¦¬ API ìƒì„±

**íŒŒì¼ ìƒì„±**: `/home/userhyeseon28/projects/cruise-guide/app/api/user/messages/[messageId]/read/route.ts`

**ì‘ì—… ë°©ë²•**:
1. íŒŒì¼ íƒìƒ‰ê¸°ì—ì„œ `app/api/user/messages` í´ë” ì—´ê¸°
2. `[messageId]` í´ë” ìƒì„±
3. `read` í´ë” ìƒì„±
4. `route.ts` íŒŒì¼ ìƒì„±
5. ì•„ë˜ ì½”ë“œ ì „ì²´ë¥¼ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°:

```typescript
import { NextRequest, NextResponse } from 'next/server';
import prisma from '@/lib/prisma';
import { getSessionUser } from '@/lib/auth';

// POST: ë©”ì‹œì§€ í™•ì¸ ì²˜ë¦¬
export async function POST(
  req: NextRequest,
  { params }: { params: { messageId: string } }
) {
  try {
    const user = await getSessionUser();
    if (!user) {
      return NextResponse.json({ ok: false, error: 'Unauthorized' }, { status: 401 });
    }

    const messageId = parseInt(params.messageId);
    if (isNaN(messageId)) {
      return NextResponse.json(
        { ok: false, error: 'Invalid message ID' },
        { status: 400 }
      );
    }

    // ë©”ì‹œì§€ê°€ ì¡´ì¬í•˜ê³  ì‚¬ìš©ìì—ê²Œ ë°œì†¡ëœ ê²ƒì¸ì§€ í™•ì¸
    const message = await prisma.adminMessage.findFirst({
      where: {
        id: messageId,
        isActive: true,
        OR: [
          { userId: user.id },
          { userId: null }, // ì „ì²´ ê³ ê° ëŒ€ìƒ
        ],
      },
    });

    if (!message) {
      return NextResponse.json(
        { ok: false, error: 'Message not found' },
        { status: 404 }
      );
    }

    // ì´ë¯¸ í™•ì¸í–ˆëŠ”ì§€ í™•ì¸
    const existingRead = await prisma.userMessageRead.findUnique({
      where: {
        userId_messageId: {
          userId: user.id,
          messageId: messageId,
        },
      },
    });

    if (!existingRead) {
      // í™•ì¸ ê¸°ë¡ ìƒì„±
      await prisma.userMessageRead.create({
        data: {
          userId: user.id,
          messageId: messageId,
        },
      });

      // ë©”ì‹œì§€ì˜ readCount ì¦ê°€
      await prisma.adminMessage.update({
        where: { id: messageId },
        data: {
          readCount: { increment: 1 },
        },
      });
    }

    return NextResponse.json({ ok: true });
  } catch (error) {
    console.error('[User Messages Read POST] Error:', error);
    return NextResponse.json(
      { ok: false, error: 'Failed to mark message as read' },
      { status: 500 }
    );
  }
}
```

**âœ… ì™„ë£Œ í™•ì¸**: 3ê°œ íŒŒì¼ì´ ëª¨ë‘ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸

---

### ğŸ”´ 3ë‹¨ê³„: ê´€ë¦¬ì í˜ì´ì§€ UI ìƒì„±

**ëª©ì **: ê´€ë¦¬ìê°€ ë©”ì‹œì§€ë¥¼ ì‘ì„±í•˜ê³  ë°œì†¡í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€ ë§Œë“¤ê¸°

**ì‘ì—… ìˆœì„œ**:

#### 3-1. ë©”ì‹œì§€ ê´€ë¦¬ í˜ì´ì§€ ìƒì„±

**íŒŒì¼ ìƒì„±**: `/home/userhyeseon28/projects/cruise-guide/app/admin/messages/page.tsx`

**ì‘ì—… ë°©ë²•**:
1. íŒŒì¼ íƒìƒ‰ê¸°ì—ì„œ `app/admin` í´ë” ì—´ê¸°
2. `messages` í´ë” ìƒì„±
3. `page.tsx` íŒŒì¼ ìƒì„±
4. ì•„ë˜ ì½”ë“œ ì „ì²´ë¥¼ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°:

```typescript
'use client';

import { useState, useEffect } from 'react';
import { FiPlus, FiEdit, FiTrash2, FiSend, FiUsers, FiUser } from 'react-icons/fi';

type Message = {
  id: number;
  title: string;
  content: string;
  messageType: string;
  userId: number | null;
  user: { id: number; name: string; phone: string } | null;
  isActive: boolean;
  readCount: number;
  totalSent: number;
  createdAt: string;
  admin: { id: number; name: string };
};

export default function AdminMessagesPage() {
  const [messages, setMessages] = useState<Message[]>([]);
  const [isLoading, setIsLoading] = useState(true);
  const [showModal, setShowModal] = useState(false);
  const [editingMessage, setEditingMessage] = useState<Message | null>(null);
  const [selectedUserId, setSelectedUserId] = useState<string>('');
  const [searchQuery, setSearchQuery] = useState('');

  // í¼ ë°ì´í„°
  const [formData, setFormData] = useState({
    title: '',
    content: '',
    messageType: 'info',
    userId: '',
  });

  // ë©”ì‹œì§€ ëª©ë¡ ë¡œë“œ
  const loadMessages = async () => {
    try {
      setIsLoading(true);
      const response = await fetch('/api/admin/messages', {
        credentials: 'include',
      });
      const data = await response.json();
      if (data.ok) {
        setMessages(data.messages);
      }
    } catch (error) {
      console.error('Failed to load messages:', error);
      alert('ë©”ì‹œì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setIsLoading(false);
    }
  };

  useEffect(() => {
    loadMessages();
  }, []);

  // ë©”ì‹œì§€ ë°œì†¡
  const handleSend = async () => {
    if (!formData.title || !formData.content) {
      alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
      return;
    }

    try {
      const response = await fetch('/api/admin/messages', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({
          userId: formData.userId || null,
          title: formData.title,
          content: formData.content,
          messageType: formData.messageType,
        }),
      });

      const data = await response.json();
      if (data.ok) {
        alert('ë©”ì‹œì§€ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        setShowModal(false);
        setFormData({ title: '', content: '', messageType: 'info', userId: '' });
        loadMessages();
      } else {
        alert('ë©”ì‹œì§€ ë°œì†¡ ì‹¤íŒ¨: ' + (data.error || 'Unknown error'));
      }
    } catch (error) {
      console.error('Failed to send message:', error);
      alert('ë©”ì‹œì§€ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };

  // ë©”ì‹œì§€ ì‚­ì œ
  const handleDelete = async (id: number) => {
    if (!confirm('ì •ë§ ì´ ë©”ì‹œì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      return;
    }

    try {
      const response = await fetch(`/api/admin/messages?id=${id}`, {
        method: 'DELETE',
        credentials: 'include',
      });

      const data = await response.json();
      if (data.ok) {
        alert('ë©”ì‹œì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        loadMessages();
      } else {
        alert('ë©”ì‹œì§€ ì‚­ì œ ì‹¤íŒ¨: ' + (data.error || 'Unknown error'));
      }
    } catch (error) {
      console.error('Failed to delete message:', error);
      alert('ë©”ì‹œì§€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };

  // ë©”ì‹œì§€ ë¹„í™œì„±í™”/í™œì„±í™”
  const handleToggleActive = async (message: Message) => {
    try {
      const response = await fetch('/api/admin/messages', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({
          id: message.id,
          title: message.title,
          content: message.content,
          messageType: message.messageType,
          isActive: !message.isActive,
        }),
      });

      const data = await response.json();
      if (data.ok) {
        loadMessages();
      } else {
        alert('ë©”ì‹œì§€ ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨: ' + (data.error || 'Unknown error'));
      }
    } catch (error) {
      console.error('Failed to toggle message:', error);
      alert('ë©”ì‹œì§€ ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };

  // í•„í„°ë§ëœ ë©”ì‹œì§€ ëª©ë¡
  const filteredMessages = messages.filter((msg) => {
    if (searchQuery) {
      return (
        msg.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
        msg.content.toLowerCase().includes(searchQuery.toLowerCase())
      );
    }
    return true;
  });

  return (
    <div className="min-h-screen bg-gray-100 p-8">
      <div className="max-w-7xl mx-auto">
        {/* í—¤ë” */}
        <div className="mb-6 flex items-center justify-between">
          <div>
            <h1 className="text-3xl font-bold text-gray-900">ê³ ê° ë©”ì‹œì§€ ê´€ë¦¬</h1>
            <p className="text-gray-600 mt-1">ê³ ê°ì—ê²Œ íŒì—… ë©”ì‹œì§€ë¥¼ ë°œì†¡í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>
          </div>
          <button
            onClick={() => {
              setEditingMessage(null);
              setFormData({ title: '', content: '', messageType: 'info', userId: '' });
              setShowModal(true);
            }}
            className="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 flex items-center gap-2"
          >
            <FiPlus size={20} />
            ìƒˆ ë©”ì‹œì§€ ì‘ì„±
          </button>
        </div>

        {/* ê²€ìƒ‰ */}
        <div className="mb-6">
          <input
            type="text"
            placeholder="ë©”ì‹œì§€ ê²€ìƒ‰..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            className="w-full max-w-md px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          />
        </div>

        {/* ë©”ì‹œì§€ ëª©ë¡ */}
        {isLoading ? (
          <div className="text-center py-12">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
            <p className="mt-4 text-gray-600">ë¡œë”© ì¤‘...</p>
          </div>
        ) : filteredMessages.length === 0 ? (
          <div className="text-center py-12 bg-white rounded-lg">
            <p className="text-gray-500">ë°œì†¡ëœ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        ) : (
          <div className="space-y-4">
            {filteredMessages.map((message) => (
              <div
                key={message.id}
                className={`bg-white rounded-lg shadow-sm border-2 p-6 ${
                  !message.isActive ? 'opacity-60' : ''
                }`}
              >
                <div className="flex items-start justify-between">
                  <div className="flex-1">
                    <div className="flex items-center gap-3 mb-2">
                      <h3 className="text-xl font-bold text-gray-900">{message.title}</h3>
                      <span
                        className={`px-3 py-1 rounded-full text-sm font-semibold ${
                          message.messageType === 'info'
                            ? 'bg-blue-100 text-blue-700'
                            : message.messageType === 'warning'
                            ? 'bg-yellow-100 text-yellow-700'
                            : message.messageType === 'promotion'
                            ? 'bg-green-100 text-green-700'
                            : 'bg-gray-100 text-gray-700'
                        }`}
                      >
                        {message.messageType === 'info'
                          ? 'ì •ë³´'
                          : message.messageType === 'warning'
                          ? 'ê²½ê³ '
                          : message.messageType === 'promotion'
                          ? 'í”„ë¡œëª¨ì…˜'
                          : 'ê³µì§€'}
                      </span>
                      {message.userId ? (
                        <span className="flex items-center gap-1 text-sm text-gray-600">
                          <FiUser size={16} />
                          {message.user?.name || 'ê³ ê°'} ({message.user?.phone})
                        </span>
                      ) : (
                        <span className="flex items-center gap-1 text-sm text-gray-600">
                          <FiUsers size={16} />
                          ì „ì²´ ê³ ê°
                        </span>
                      )}
                      {!message.isActive && (
                        <span className="px-2 py-1 bg-gray-200 text-gray-600 text-xs rounded">
                          ë¹„í™œì„±í™”ë¨
                        </span>
                      )}
                    </div>
                    <div
                      className="text-gray-700 mb-4"
                      dangerouslySetInnerHTML={{ __html: message.content }}
                    />
                    <div className="flex items-center gap-4 text-sm text-gray-500">
                      <span>ë°œì†¡: {new Date(message.createdAt).toLocaleString('ko-KR')}</span>
                      <span>í™•ì¸: {message.readCount} / {message.totalSent}</span>
                    </div>
                  </div>
                  <div className="flex items-center gap-2 ml-4">
                    <button
                      onClick={() => handleToggleActive(message)}
                      className={`px-4 py-2 rounded-lg font-semibold ${
                        message.isActive
                          ? 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200'
                          : 'bg-green-100 text-green-700 hover:bg-green-200'
                      }`}
                    >
                      {message.isActive ? 'ë¹„í™œì„±í™”' : 'í™œì„±í™”'}
                    </button>
                    <button
                      onClick={() => handleDelete(message.id)}
                      className="px-4 py-2 bg-red-100 text-red-700 rounded-lg font-semibold hover:bg-red-200 flex items-center gap-2"
                    >
                      <FiTrash2 size={16} />
                      ì‚­ì œ
                    </button>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}

        {/* ë©”ì‹œì§€ ì‘ì„± ëª¨ë‹¬ */}
        {showModal && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-2xl shadow-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto">
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-2xl font-bold text-gray-900">ë©”ì‹œì§€ ì‘ì„±</h2>
                <button
                  onClick={() => setShowModal(false)}
                  className="text-gray-500 hover:text-gray-700 text-2xl"
                >
                  Ã—
                </button>
              </div>

              <div className="space-y-4">
                {/* ìˆ˜ì‹ ì ì„ íƒ */}
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    ìˆ˜ì‹ ì ì„ íƒ
                  </label>
                  <div className="flex gap-4 mb-2">
                    <label className="flex items-center gap-2">
                      <input
                        type="radio"
                        name="recipient"
                        value="all"
                        checked={!formData.userId}
                        onChange={() => setFormData({ ...formData, userId: '' })}
                      />
                      <span className="text-base">ì „ì²´ ê³ ê°</span>
                    </label>
                    <label className="flex items-center gap-2">
                      <input
                        type="radio"
                        name="recipient"
                        value="specific"
                        checked={!!formData.userId}
                        onChange={() => setFormData({ ...formData, userId: '0' })}
                      />
                      <span className="text-base">íŠ¹ì • ê³ ê°</span>
                    </label>
                  </div>
                  {formData.userId && (
                    <div className="mt-2">
                      <input
                        type="number"
                        placeholder="ê³ ê° ID ì…ë ¥ (ì˜ˆ: 1, 2, 3)"
                        value={formData.userId === '0' ? '' : formData.userId}
                        onChange={(e) => setFormData({ ...formData, userId: e.target.value || '0' })}
                        className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base"
                      />
                      <p className="text-sm text-gray-500 mt-1">
                        ğŸ’¡ ê³ ê° ê´€ë¦¬ í˜ì´ì§€ì—ì„œ ê³ ê° IDë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                      </p>
                    </div>
                  )}
                </div>

                {/* ë©”ì‹œì§€ íƒ€ì… */}
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    ë©”ì‹œì§€ íƒ€ì…
                  </label>
                  <select
                    value={formData.messageType}
                    onChange={(e) => setFormData({ ...formData, messageType: e.target.value })}
                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                  >
                    <option value="info">ì •ë³´</option>
                    <option value="warning">ê²½ê³ </option>
                    <option value="promotion">í”„ë¡œëª¨ì…˜</option>
                    <option value="announcement">ê³µì§€</option>
                  </select>
                </div>

                {/* ì œëª© */}
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    ì œëª© <span className="text-red-500">*</span>
                  </label>
                  <input
                    type="text"
                    value={formData.title}
                    onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                    placeholder="ë©”ì‹œì§€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg"
                  />
                </div>

                {/* ë‚´ìš© */}
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">
                    ë‚´ìš© <span className="text-red-500">*</span>
                  </label>
                  <textarea
                    value={formData.content}
                    onChange={(e) => setFormData({ ...formData, content: e.target.value })}
                    placeholder="ë©”ì‹œì§€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš” (HTML ì‚¬ìš© ê°€ëŠ¥)"
                    rows={8}
                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base"
                  />
                  <p className="text-sm text-gray-500 mt-1">
                    HTML íƒœê·¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆ: &lt;br&gt;, &lt;strong&gt;, &lt;em&gt;
                  </p>
                </div>

                {/* ë²„íŠ¼ */}
                <div className="flex gap-3 pt-4">
                  <button
                    onClick={() => setShowModal(false)}
                    className="flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-lg font-semibold hover:bg-gray-200"
                  >
                    ì·¨ì†Œ
                  </button>
                  <button
                    onClick={handleSend}
                    className="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 flex items-center justify-center gap-2"
                  >
                    <FiSend size={18} />
                    ë©”ì‹œì§€ ë°œì†¡
                  </button>
                </div>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
```

**âœ… ì™„ë£Œ í™•ì¸**: íŒŒì¼ì´ ì €ì¥ë˜ì—ˆëŠ”ì§€ í™•ì¸

---

#### 3-2. ê´€ë¦¬ì ë ˆì´ì•„ì›ƒì— ë©”ë‰´ ì¶”ê°€

**íŒŒì¼ ìˆ˜ì •**: `/home/userhyeseon28/projects/cruise-guide/app/admin/layout.tsx`

**ì‘ì—… ë°©ë²•**:
1. `app/admin/layout.tsx` íŒŒì¼ ì—´ê¸°
2. `menuItems` ë°°ì—´ ì°¾ê¸° (ì•½ 68ë²ˆì§¸ ì¤„ ê·¼ì²˜)
3. ì•„ë˜ ì½”ë“œë¥¼ ë°°ì—´ì— ì¶”ê°€:

```typescript
{ href: '/admin/messages', label: 'ê³ ê° ë©”ì‹œì§€', icon: 'ğŸ’¬' },
```

**ì „ì²´ menuItems ë°°ì—´ ì˜ˆì‹œ**:
```typescript
const menuItems = [
  { href: '/admin/dashboard', label: 'ëŒ€ì‹œë³´ë“œ', icon: 'ğŸ“Š' },
  { href: '/admin/customers', label: 'ê³ ê° ê´€ë¦¬', icon: 'ğŸ‘¥' },
  { href: '/admin/messages', label: 'ê³ ê° ë©”ì‹œì§€', icon: 'ğŸ’¬' },
  // ... ê¸°ì¡´ í•­ëª©ë“¤
];
```

**âœ… ì™„ë£Œ í™•ì¸**: ì €ì¥ í›„ ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ "ê³ ê° ë©”ì‹œì§€" ë©”ë‰´ê°€ ë³´ì´ëŠ”ì§€ í™•ì¸

---

### ğŸ”´ 4ë‹¨ê³„: ê³ ê° í˜ì´ì§€ íŒì—… ì»´í¬ë„ŒíŠ¸ ìƒì„±

**ëª©ì **: ê³ ê°ì´ ë¡œê·¸ì¸ ì‹œ ë¯¸í™•ì¸ ë©”ì‹œì§€ë¥¼ íŒì—…ìœ¼ë¡œ ë³´ì—¬ì£¼ê¸°

**ì‘ì—… ìˆœì„œ**:

#### 4-1. ë©”ì‹œì§€ íŒì—… ì»´í¬ë„ŒíŠ¸ ìƒì„±

**íŒŒì¼ ìƒì„±**: `/home/userhyeseon28/projects/cruise-guide/components/AdminMessageModal.tsx`

**ì‘ì—… ë°©ë²•**:
1. íŒŒì¼ íƒìƒ‰ê¸°ì—ì„œ `components` í´ë” ì—´ê¸°
2. `AdminMessageModal.tsx` íŒŒì¼ ìƒì„±
3. ì•„ë˜ ì½”ë“œ ì „ì²´ë¥¼ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°:

```typescript
'use client';

import { useState, useEffect } from 'react';
import { FiX, FiInfo, FiAlertTriangle, FiGift, FiBell } from 'react-icons/fi';

type Message = {
  id: number;
  title: string;
  content: string;
  messageType: string;
  admin: { id: number; name: string };
  createdAt: string;
};

export default function AdminMessageModal() {
  const [messages, setMessages] = useState<Message[]>([]);
  const [currentMessageIndex, setCurrentMessageIndex] = useState(0);
  const [isVisible, setIsVisible] = useState(false);

  // ë©”ì‹œì§€ ë¡œë“œ
  useEffect(() => {
    const loadMessages = async () => {
      try {
        const response = await fetch('/api/user/messages', {
          credentials: 'include',
        });
        const data = await response.json();
        if (data.ok && data.messages && data.messages.length > 0) {
          setMessages(data.messages);
          setIsVisible(true);
          setCurrentMessageIndex(0);
        }
      } catch (error) {
        console.error('Failed to load messages:', error);
      }
    };

    loadMessages();
  }, []);

  // ë©”ì‹œì§€ í™•ì¸ ì²˜ë¦¬
  const handleRead = async (messageId: number) => {
    try {
      await fetch(`/api/user/messages/${messageId}/read`, {
        method: 'POST',
        credentials: 'include',
      });
    } catch (error) {
      console.error('Failed to mark message as read:', error);
    }
  };

  // í˜„ì¬ ë©”ì‹œì§€
  const currentMessage = messages[currentMessageIndex];

  // ë©”ì‹œì§€ ë‹«ê¸°
  const handleClose = () => {
    if (currentMessage) {
      handleRead(currentMessage.id);
    }

    // ë‹¤ìŒ ë©”ì‹œì§€ê°€ ìˆìœ¼ë©´ ë‹¤ìŒ ë©”ì‹œì§€ë¡œ, ì—†ìœ¼ë©´ ë‹«ê¸°
    if (currentMessageIndex < messages.length - 1) {
      setCurrentMessageIndex(currentMessageIndex + 1);
    } else {
      setIsVisible(false);
    }
  };

  // ë©”ì‹œì§€ íƒ€ì…ë³„ ì•„ì´ì½˜
  const getIcon = () => {
    switch (currentMessage?.messageType) {
      case 'warning':
        return <FiAlertTriangle className="text-yellow-600" size={24} />;
      case 'promotion':
        return <FiGift className="text-green-600" size={24} />;
      case 'announcement':
        return <FiBell className="text-blue-600" size={24} />;
      default:
        return <FiInfo className="text-blue-600" size={24} />;
    }
  };

  // ë©”ì‹œì§€ íƒ€ì…ë³„ ë°°ê²½ìƒ‰
  const getBgColor = () => {
    switch (currentMessage?.messageType) {
      case 'warning':
        return 'bg-yellow-50 border-yellow-200';
      case 'promotion':
        return 'bg-green-50 border-green-200';
      case 'announcement':
        return 'bg-blue-50 border-blue-200';
      default:
        return 'bg-blue-50 border-blue-200';
    }
  };

  if (!isVisible || !currentMessage) {
    return null;
  }

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div
        className={`bg-white rounded-2xl shadow-2xl max-w-md w-full border-2 ${getBgColor()}`}
      >
        {/* í—¤ë” */}
        <div className="flex items-center justify-between p-6 border-b border-gray-200">
          <div className="flex items-center gap-3">
            {getIcon()}
            <h2 className="text-xl font-bold text-gray-900">{currentMessage.title}</h2>
          </div>
          <button
            onClick={handleClose}
            className="text-gray-500 hover:text-gray-700 p-1"
            aria-label="ë‹«ê¸°"
          >
            <FiX size={24} />
          </button>
        </div>

        {/* ë‚´ìš© */}
        <div className="p-6">
          <div
            className="text-gray-700 text-base leading-relaxed"
            dangerouslySetInnerHTML={{ __html: currentMessage.content }}
          />
          <p className="text-sm text-gray-500 mt-4">
            ë°œì†¡ì: {currentMessage.admin.name}
          </p>
        </div>

        {/* í‘¸í„° */}
        <div className="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
          {messages.length > 1 && (
            <p className="text-sm text-gray-500">
              {currentMessageIndex + 1} / {messages.length}
            </p>
          )}
          <button
            onClick={handleClose}
            className="px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700"
          >
            í™•ì¸
          </button>
        </div>
      </div>
    </div>
  );
}
```

**âœ… ì™„ë£Œ í™•ì¸**: íŒŒì¼ì´ ì €ì¥ë˜ì—ˆëŠ”ì§€ í™•ì¸

---

#### 4-2. ì±„íŒ… í˜ì´ì§€ì— ë©”ì‹œì§€ ëª¨ë‹¬ ì¶”ê°€

**íŒŒì¼ ìˆ˜ì •**: `/home/userhyeseon28/projects/cruise-guide/app/chat/components/ChatInteractiveUI.tsx`

**ì‘ì—… ë°©ë²•**:
1. `app/chat/components/ChatInteractiveUI.tsx` íŒŒì¼ ì—´ê¸°
2. íŒŒì¼ ìƒë‹¨ì˜ import ë¶€ë¶„ ì°¾ê¸° (ì•½ 1-12ë²ˆì§¸ ì¤„)
3. ì•„ë˜ import ì¶”ê°€:

```typescript
import AdminMessageModal from '@/components/AdminMessageModal';
```

4. íŒŒì¼ì˜ `return` ë¶€ë¶„ ì°¾ê¸° (ì•½ 207ë²ˆì§¸ ì¤„ ê·¼ì²˜)
5. `</>` íƒœê·¸ ë°”ë¡œ ì•ì— ì•„ë˜ ì½”ë“œ ì¶”ê°€:

```typescript
      {/* ê´€ë¦¬ì ë©”ì‹œì§€ íŒì—… */}
      <AdminMessageModal />
```

**ì „ì²´ êµ¬ì¡° ì˜ˆì‹œ**:
```typescript
return (
  <>
    {/* "ë°°ë¡œ ëŒì•„ê°€ê¸°" ì¹´ìš´íŠ¸ë‹¤ìš´ ë°°ë„ˆ */}
    <ReturnToShipBanner />
    
    {/* ... ê¸°ì¡´ ì½”ë“œ ... */}
    
    {/* ê´€ë¦¬ì ë©”ì‹œì§€ íŒì—… */}
    <AdminMessageModal />
  </>
);
```

**âœ… ì™„ë£Œ í™•ì¸**: íŒŒì¼ì´ ì €ì¥ë˜ì—ˆëŠ”ì§€ í™•ì¸

---

#### 4-3. (ì„ íƒ) ë‹¤ë¥¸ í˜ì´ì§€ì—ë„ ì¶”ê°€

**ì¶”ê°€í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€**:
- `/app/profile/page.tsx`
- `/app/map/page.tsx`
- `/app/checklist/page.tsx`
- `/app/wallet/page.tsx`

**ì‘ì—… ë°©ë²•**: ìœ„ì™€ ë™ì¼í•˜ê²Œ `AdminMessageModal` importí•˜ê³  ì»´í¬ë„ŒíŠ¸ ì¶”ê°€

---

### ğŸ”´ 5ë‹¨ê³„: í†µí•© í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ìˆœì„œ**:

1. **ê°œë°œ ì„œë²„ ì¬ì‹œì‘**
   ```bash
   # í„°ë¯¸ë„ì—ì„œ
   cd /home/userhyeseon28/projects/cruise-guide
   # ì‹¤í–‰ ì¤‘ì¸ ì„œë²„ê°€ ìˆìœ¼ë©´ ì¤‘ì§€ (Ctrl + C)
   npm run dev
   ```

2. **ê´€ë¦¬ì ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸**
   - ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:3030/admin/login` ì ‘ì†
   - ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
   - ì¢Œì¸¡ ë©”ë‰´ì—ì„œ "ê³ ê° ë©”ì‹œì§€" í´ë¦­

3. **ë©”ì‹œì§€ ë°œì†¡ í…ŒìŠ¤íŠ¸**
   - "ìƒˆ ë©”ì‹œì§€ ì‘ì„±" ë²„íŠ¼ í´ë¦­
   - "ì „ì²´ ê³ ê°" ì„ íƒ
   - ì œëª©: "í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€"
   - ë‚´ìš©: "ì´ê²ƒì€ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ì…ë‹ˆë‹¤."
   - "ë©”ì‹œì§€ ë°œì†¡" ë²„íŠ¼ í´ë¦­

4. **ê³ ê° í˜ì´ì§€ì—ì„œ í™•ì¸**
   - ì¼ë°˜ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸ (`http://localhost:3030/login`)
   - ì±„íŒ… í˜ì´ì§€ ì ‘ì†
   - íŒì—… ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚˜ëŠ”ì§€ í™•ì¸
   - "í™•ì¸" ë²„íŠ¼ í´ë¦­

5. **íŠ¹ì • ê³ ê°ì—ê²Œ ë°œì†¡ í…ŒìŠ¤íŠ¸**
   - ê´€ë¦¬ì í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
   - "ìƒˆ ë©”ì‹œì§€ ì‘ì„±"
   - "íŠ¹ì • ê³ ê°" ì„ íƒ
   - ê³ ê° ID ì…ë ¥ (ì¼ë°˜ ì‚¬ìš©ìì˜ ID)
   - ë©”ì‹œì§€ ë°œì†¡
   - í•´ë‹¹ ê³ ê°ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì—¬ í™•ì¸

---

## 4. í…ŒìŠ¤íŠ¸ ë°©ë²•

### 4.1 ì •ìƒ ì‘ë™ í™•ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ "ê³ ê° ë©”ì‹œì§€" ë©”ë‰´ê°€ ë³´ì„
- [ ] "ìƒˆ ë©”ì‹œì§€ ì‘ì„±" ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ì´ ì—´ë¦¼
- [ ] ì „ì²´ ê³ ê° ëŒ€ìƒ ë©”ì‹œì§€ ë°œì†¡ ì„±ê³µ
- [ ] íŠ¹ì • ê³ ê° ëŒ€ìƒ ë©”ì‹œì§€ ë°œì†¡ ì„±ê³µ
- [ ] ê³ ê° ë¡œê·¸ì¸ ì‹œ íŒì—… ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚¨
- [ ] "í™•ì¸" ë²„íŠ¼ í´ë¦­ ì‹œ ë©”ì‹œì§€ê°€ ì‚¬ë¼ì§
- [ ] ë©”ì‹œì§€ í™•ì¸ í›„ ë‹¤ì‹œ ë¡œê·¸ì¸í•´ë„ ê°™ì€ ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚˜ì§€ ì•ŠìŒ

---

## 5. ë¬¸ì œ í•´ê²°

### 5.1 ìì£¼ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜

#### ì˜¤ë¥˜ 1: "Migration failed"

**ì›ì¸**: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë¬¸ë²• ì˜¤ë¥˜

**í•´ê²° ë°©ë²•**:
1. `prisma/schema.prisma` íŒŒì¼ í™•ì¸
2. ì¤‘ê´„í˜¸ `{ }`ê°€ ì œëŒ€ë¡œ ë‹«í˜”ëŠ”ì§€ í™•ì¸
3. ì‰¼í‘œ `,`ê°€ ë¹ ì§€ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
4. ë‹¤ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰:
   ```bash
   npx prisma migrate dev --name add_admin_message_system
   ```

#### ì˜¤ë¥˜ 2: "Unauthorized" ì—ëŸ¬

**ì›ì¸**: ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŒ

**í•´ê²° ë°©ë²•**:
1. ê´€ë¦¬ì ê³„ì •ì˜ `role`ì´ `'admin'`ì¸ì§€ í™•ì¸
2. ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§ì ‘ í™•ì¸:
   ```bash
   npx prisma studio
   # User í…Œì´ë¸”ì—ì„œ ê´€ë¦¬ì ê³„ì •ì˜ role í™•ì¸
   ```

#### ì˜¤ë¥˜ 3: íŒì—… ë©”ì‹œì§€ê°€ ë‚˜íƒ€ë‚˜ì§€ ì•ŠìŒ

**ì›ì¸**: API í˜¸ì¶œ ì‹¤íŒ¨ ë˜ëŠ” ë©”ì‹œì§€ê°€ ì—†ìŒ

**í•´ê²° ë°©ë²•**:
1. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ ì—´ê¸° (F12)
2. Console íƒ­ì—ì„œ ì—ëŸ¬ í™•ì¸
3. Network íƒ­ì—ì„œ `/api/user/messages` ìš”ì²­ í™•ì¸
4. ì‘ë‹µì´ `{ ok: true, messages: [...] }` í˜•íƒœì¸ì§€ í™•ì¸

---

## 6. ì¶”ê°€ ê¸°ëŠ¥ (ì„ íƒì‚¬í•­)

### 6.1 ë©”ì‹œì§€ ì˜ˆì•½ ë°œì†¡

**êµ¬í˜„ ë°©ë²•**:
- `sendAt` í•„ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ˆì•½ ë°œì†¡ ì‹œê°„ ì„¤ì •
- ì„œë²„ì—ì„œ ì£¼ê¸°ì ìœ¼ë¡œ ì²´í¬í•˜ì—¬ ë°œì†¡

### 6.2 ë©”ì‹œì§€ í…œí”Œë¦¿

**êµ¬í˜„ ë°©ë²•**:
- ìì£¼ ì‚¬ìš©í•˜ëŠ” ë©”ì‹œì§€ë¥¼ í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥
- í…œí”Œë¦¿ ì„ íƒ ì‹œ ìë™ìœ¼ë¡œ ë‚´ìš© ì±„ìš°ê¸°

### 6.3 ë©”ì‹œì§€ í†µê³„

**êµ¬í˜„ ë°©ë²•**:
- ë©”ì‹œì§€ë³„ í™•ì¸ë¥  ê³„ì‚°
- ë°œì†¡ ì‹œê°„ëŒ€ë³„ íš¨ê³¼ ë¶„ì„

---

## 7. ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°ì´í„°ë² ì´ìŠ¤
- [ ] `AdminMessage` ëª¨ë¸ ì¶”ê°€ ì™„ë£Œ
- [ ] `UserMessageRead` ëª¨ë¸ ì¶”ê°€ ì™„ë£Œ
- [ ] `User` ëª¨ë¸ì— ê´€ê³„ ì¶”ê°€ ì™„ë£Œ
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ

### API
- [ ] `/api/admin/messages` (GET, POST, PUT, DELETE) ì™„ë£Œ
- [ ] `/api/user/messages` (GET) ì™„ë£Œ
- [ ] `/api/user/messages/[messageId]/read` (POST) ì™„ë£Œ

### ê´€ë¦¬ì í˜ì´ì§€
- [ ] `/admin/messages` í˜ì´ì§€ ìƒì„± ì™„ë£Œ
- [ ] ê´€ë¦¬ì ë ˆì´ì•„ì›ƒì— ë©”ë‰´ ì¶”ê°€ ì™„ë£Œ

### ê³ ê° í˜ì´ì§€
- [ ] `AdminMessageModal` ì»´í¬ë„ŒíŠ¸ ìƒì„± ì™„ë£Œ
- [ ] `ChatInteractiveUI`ì— ëª¨ë‹¬ ì¶”ê°€ ì™„ë£Œ

### í…ŒìŠ¤íŠ¸
- [ ] ì „ì²´ ê³ ê° ë©”ì‹œì§€ ë°œì†¡ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] íŠ¹ì • ê³ ê° ë©”ì‹œì§€ ë°œì†¡ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] íŒì—… ë©”ì‹œì§€ í‘œì‹œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ
- [ ] ë©”ì‹œì§€ í™•ì¸ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ì™„ë£Œ

---

## 8. ë‹¤ìŒ ë‹¨ê³„

### ê¸°ë³¸ ê¸°ëŠ¥ ì™„ë£Œ í›„ ì¶”ê°€ ê°€ëŠ¥í•œ ê¸°ëŠ¥

1. **ë©”ì‹œì§€ ë°œì†¡ ì´ë ¥ ì¡°íšŒ**
   - ì–¸ì œ ëˆ„êµ¬ì—ê²Œ ë°œì†¡í–ˆëŠ”ì§€ ìƒì„¸ ê¸°ë¡

2. **ë©”ì‹œì§€ ì½ìŒ/ì•ˆ ì½ìŒ í†µê³„**
   - ê° ë©”ì‹œì§€ì˜ í™•ì¸ë¥  í‘œì‹œ

3. **ê³ ê° ê²€ìƒ‰ ê¸°ëŠ¥**
   - ë©”ì‹œì§€ ì‘ì„± ì‹œ ê³ ê° ê²€ìƒ‰í•˜ì—¬ ì„ íƒ

4. **ë©”ì‹œì§€ í…œí”Œë¦¿ ê´€ë¦¬**
   - ìì£¼ ì‚¬ìš©í•˜ëŠ” ë©”ì‹œì§€ í…œí”Œë¦¿ ì €ì¥

---

**ì‘ì„±ì**: AI Assistant  
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-11-04  
**ì˜ˆìƒ ì‘ì—… ì‹œê°„**: 45ë¶„

---

## ğŸ’¡ íŒ

### ì½”ë”© ì§€ì‹ì´ ì—†ì–´ë„ í•  ìˆ˜ ìˆëŠ” ì´ìœ 

1. **ë³µì‚¬ & ë¶™ì—¬ë„£ê¸°**: ëª¨ë“  ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤.
2. **íŒŒì¼ ìƒì„±/ìˆ˜ì •**: íŒŒì¼ íƒìƒ‰ê¸°ì—ì„œ í´ë” ë§Œë“¤ê³  íŒŒì¼ ìƒì„±ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.
3. **ëª…ë ¹ì–´ ì‹¤í–‰**: í„°ë¯¸ë„ì— ëª…ë ¹ì–´ë¥¼ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸°ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤.

### ë¬¸ì œ ë°œìƒ ì‹œ

1. **ì—ëŸ¬ ë©”ì‹œì§€ ë³µì‚¬**: ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì „ì²´ ë³µì‚¬í•´ì„œ ì €ì¥
2. **ì–´ëŠ ë‹¨ê³„ì—ì„œ ë°œìƒí–ˆëŠ”ì§€ í™•ì¸**: ìœ„ì˜ ë‹¨ê³„ ë²ˆí˜¸ë¥¼ ê¸°ë¡
3. **íŒŒì¼ ìœ„ì¹˜ í™•ì¸**: ìˆ˜ì •í•œ íŒŒì¼ì˜ ê²½ë¡œë¥¼ í™•ì¸

---

**ì´ì œ ì‘ì—…ì„ ì‹œì‘í•˜ì„¸ìš”! ê° ë‹¨ê³„ë¥¼ ìˆœì„œëŒ€ë¡œ ë”°ë¼í•˜ì‹œë©´ ë©ë‹ˆë‹¤.** ğŸš€
