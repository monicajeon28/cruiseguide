# 🔄 재구매 전환 추적 시스템 테스트 가이드

## 🚀 빠른 테스트 방법

### 1단계: 관리자 페이지 접속
```
http://localhost:3030/admin/rePurchase
```

### 2단계: 데이터 확인
- 페이지가 로드되면 트리거 목록과 통계가 표시됩니다
- 데이터가 없으면 "트리거가 없습니다" 메시지가 표시됩니다

### 3단계: 테스트용 트리거 생성 (브라우저 콘솔)

1. **브라우저 콘솔 열기**: `F12` → Console 탭

2. **사용자 ID 확인**:
   ```javascript
   // 관리자 페이지에서 사용자 ID 확인 후 사용
   // 또는 /admin/customers 페이지에서 확인
   ```

3. **트리거 생성**:
   ```javascript
   // 브라우저 콘솔에서 실행
   fetch('/api/admin/rePurchase/trigger', {
     method: 'POST',
     headers: { 'Content-Type': 'application/json' },
     credentials: 'include',
     body: JSON.stringify({
       userId: 1, // 실제 사용자 ID로 변경
       triggerType: 'grace_period_end',
       tripEndDate: new Date().toISOString(),
     }),
   })
   .then(r => r.json())
   .then(data => {
     console.log('트리거 생성 결과:', data);
     if (data.ok) {
       alert('트리거가 생성되었습니다! 페이지를 새로고침하세요.');
       location.reload();
     } else {
       alert('오류: ' + data.error);
     }
   })
   .catch(err => {
     console.error('오류:', err);
     alert('트리거 생성 실패: ' + err.message);
   });
   ```

### 4단계: 트리거 확인
- 페이지 새로고침 후 생성된 트리거 확인
- 통계 카드에 숫자가 업데이트되었는지 확인

### 5단계: 전환 처리 테스트
1. "전환 대기" 상태인 트리거 찾기
2. "전환 처리" 버튼 클릭
3. 확인 메시지에서 "확인" 클릭
4. 트리거가 "전환 완료" 상태로 변경되는지 확인
5. 통계 카드의 "전환 완료" 숫자가 증가하는지 확인

---

## 📊 확인할 항목

### ✅ 통계 카드
- **전체 트리거**: 생성된 트리거 총 개수
- **전환 완료**: 전환 처리된 트리거 개수
- **전환 대기**: 아직 전환되지 않은 트리거 개수
- **전환율**: (전환 완료 / 전체 트리거) × 100

### ✅ 차트
- **타입별 전환율**: 막대 차트로 표시
- **전환율 추이**: 라인 차트로 일별 추이 표시

### ✅ 필터
- **시간 범위**: 7일/30일/90일/전체
- **상태 필터**: 전체/전환 대기/전환 완료

### ✅ 트리거 목록
- 사용자 정보
- 트리거 타입
- 여행 종료일
- 메시지 발송 여부
- 전환 상태
- 생성일

---

## 🧪 고급 테스트: 스케줄러 수동 실행

터미널에서 실행:
```bash
cd /home/userhyeseon28/projects/cruise-guide
npx tsx scripts/test-repurchase-trigger.ts
```

이 스크립트는:
- 종료된 여행 확인
- 유예 기간 종료 확인
- 트리거 자동 생성

---

## 🐛 문제 해결

### 문제: 트리거가 생성되지 않음
**해결**:
1. 사용자 ID가 올바른지 확인
2. 브라우저 콘솔에서 오류 확인
3. 서버 로그 확인

### 문제: 전환 처리 버튼이 작동하지 않음
**해결**:
1. 브라우저 콘솔(F12)에서 오류 확인
2. 관리자 권한 확인
3. 서버 로그 확인

### 문제: 통계가 0으로 표시됨
**해결**:
1. 트리거가 생성되었는지 확인
2. 시간 범위 필터 확인
3. 상태 필터 확인

---

## 💡 팁

1. **테스트용 사용자 생성**: 실제 사용자 데이터가 없으면 테스트용 사용자를 생성하세요
2. **여러 트리거 생성**: 다양한 타입의 트리거를 생성하여 차트를 확인하세요
3. **전환 처리 반복**: 여러 트리거를 전환 처리하여 통계 변화를 확인하세요

---

**작성자**: AI Assistant  
**작성일**: 2025-11-04














